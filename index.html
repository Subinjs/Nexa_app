<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NEXA Price Explorer</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1d4ed8">
<style>
body{margin:0;font-family:Segoe UI,Roboto,Arial,sans-serif;background:#f8fafc}
header{background:#1d4ed8;color:#fff;padding:20px}
.container{max-width:1400px;margin:auto;padding:20px}
.controls{display:grid;grid-template-columns:1fr 1fr auto;gap:12px;align-items:center}
.selects{display:flex;gap:12px}
select,button{padding:14px;font-size:16px;border-radius:10px;border:1px solid #cbd5e1}
button{background:#1d4ed8;color:#fff;font-weight:600;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{padding:12px;border-bottom:1px solid #e5e7eb}
th{background:#1e40af;color:#fff;text-align:left}
.onroad{background:#047857!important;color:#fff;font-size:18px;font-weight:700}
@media(max-width:900px){.controls{grid-template-columns:1fr}}
.compare-list{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
.compare-item{background:#fff;border:1px solid #cbd5e1;padding:8px 10px;border-radius:8px;display:flex;gap:8px;align-items:center}
.compare-item button{background:#ef4444;border:none;padding:6px 8px;border-radius:6px;color:#fff;cursor:pointer}
.compare-panel{margin-top:20px}
.best{background:#d1fae5} /* green highlight for best */
.note{color:#374151;margin-top:6px}
.small{font-size:13px;color:#6b7280}
</style>
</head>
<body>
<header>
<h1>ðŸš— NEXA Price Explorer</h1>
<p>Free â€¢ Installable â€¢ Compare Ready</p>
</header>

<div class="container">
  <div class="controls">
    <div class="selects">
      <select id="model"><option value="">Select Model</option></select>
      <select id="variant"><option value="">Select Variant</option></select>
    </div>

    <div style="display:flex;gap:8px">
      <button id="showBtn">Show Price</button>
      <button id="addCompareBtn">Add to Compare</button>
      <button id="compareNowBtn">Compare Now</button>
    </div>
  </div>

  <div class="compare-list" id="compareList" aria-live="polite"></div>
  <div id="out"></div>
  <div id="compareOut" class="compare-panel"></div>
  <p class="note small">Tip: select a model, choose a variant, then "Add to Compare". You can compare variants across different models. Lowest costs are highlighted in green.</p>
</div>

<script>
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js').catch(()=>{});
}

const modelSel = document.getElementById("model");
const varSel   = document.getElementById("variant");
const out      = document.getElementById("out");

const MODELS = {
  "grand_vitara": "Grand Vitara",
  "xl6": "XL6",
  "baleno": "Baleno",
  "fronx": "Fronx",
  "ignis": "Ignis",
  "ciaz": "Ciaz",
  "jimny": "Jimny",
  "invicto": "Invicto"
};

let DATA = [];

// populate models
Object.keys(MODELS).forEach(key=>{
  const o = document.createElement("option");
  o.value = key;
  o.textContent = MODELS[key];
  modelSel.appendChild(o);
});

// when model changes â†’ load JSON
modelSel.addEventListener("change", async ()=>{
  varSel.innerHTML = `<option value="">Select Variant</option>`;
  out.innerHTML = "";
  DATA = [];

  if(!modelSel.value) return;

  try{
    const res = await fetch(`data/${modelSel.value}.json`);
    DATA = await res.json();

    DATA.forEach((v,i)=>{
      const o = document.createElement("option");
      o.value = i;
      o.textContent = `${v.variant} â€“ â‚¹${v.onroad.toLocaleString("en-IN")}`;
      varSel.appendChild(o);
    });

  }catch(e){
    out.innerHTML = `<p style="color:red">Failed to load variants</p>`;
  }
});

// show price
document.getElementById("showBtn").addEventListener("click", ()=>{
  if(varSel.value==="") return;

  const v = DATA[varSel.value];

  out.innerHTML = `
  <table>
    <tr><th>Variant</th><td>${v.variant}</td></tr>
    <tr><th>Fuel</th><td>${v.fuel}</td></tr>
    <tr><th>Ex-Showroom</th><td>â‚¹${v.ex_showroom.toLocaleString("en-IN")}</td></tr>
    <tr><th>Insurance</th><td>â‚¹${v.insurance.toLocaleString("en-IN")}</td></tr>
    <tr><th>Road Tax</th><td>â‚¹${v.road_tax.toLocaleString("en-IN")}</td></tr>
    <tr><th>Registration</th><td>â‚¹${v.registration}</td></tr>
    <tr><th>Fastag</th><td>â‚¹${v.fastag}</td></tr>
    <tr><th>Extended Warranty</th><td>â‚¹${v.extended_warranty.toLocaleString("en-IN")}</td></tr>
    <tr><th>Accessories</th><td>â‚¹${v.accessories.toLocaleString("en-IN")}</td></tr>
    <tr><th>NEXA Card</th><td>â‚¹${v.nexa_card}</td></tr>
    ${v.tcs>0?`<tr><th>TCS 1%</th><td>â‚¹${v.tcs.toLocaleString("en-IN")}</td></tr>`:""}
    <tr class="onroad"><th>Total On-Road</th><td>â‚¹${v.onroad.toLocaleString("en-IN")}</td></tr>
  </table>
  `;
});
</script>
</body>
</html>
